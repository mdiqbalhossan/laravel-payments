<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laravel Payments - Documentation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #6366f1;
            --secondary-color: #8b5cf6;
            --dark-color: #1e293b;
            --light-color: #f8fafc;
            --border-color: #e2e8f0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--light-color);
            color: var(--dark-color);
            line-height: 1.6;
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            width: 280px;
            padding: 2rem 1rem;
            background: white;
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            z-index: 100;
        }

        .main-content {
            margin-left: 280px;
            padding: 2rem 3rem;
            max-width: 1200px;
        }

        .doc-content {
            background: white;
            padding: 2rem 3rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 2rem;
            text-decoration: none;
        }

        .nav-section {
            margin-bottom: 2rem;
        }

        .nav-section h5 {
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            color: #64748b;
            margin-bottom: 0.75rem;
        }

        .nav-link {
            display: block;
            padding: 0.5rem 1rem;
            color: #475569;
            text-decoration: none;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .nav-link:hover {
            background: var(--light-color);
            color: var(--primary-color);
        }

        .nav-link.active {
            background: var(--primary-color);
            color: white;
        }

        pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1.5rem 0;
        }

        code {
            background: #f1f5f9;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-size: 0.875rem;
            color: #e11d48;
        }

        pre code {
            background: none;
            padding: 0;
            color: inherit;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--dark-color);
        }

        h2 {
            font-size: 2rem;
            font-weight: 600;
            margin-top: 3rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border-color);
        }

        h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-top: 2.5rem;
            margin-bottom: 1rem;
        }

        h4 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-top: 2rem;
            margin-bottom: 0.75rem;
        }

        .alert {
            padding: 1rem 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
        }

        .alert-info {
            background: #dbeafe;
            border-left: 4px solid #3b82f6;
            color: #1e40af;
        }

        .alert-warning {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            color: #92400e;
        }

        .badge {
            padding: 0.375rem 0.75rem;
            border-radius: 9999px;
            font-weight: 500;
            font-size: 0.75rem;
            text-transform: uppercase;
        }

        .gateway-card {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            transition: all 0.2s;
        }

        .gateway-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .gateway-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 0.5rem;
        }

        .gateway-description {
            color: #64748b;
            margin-bottom: 1rem;
        }

        .gateway-regions {
            font-size: 0.875rem;
            color: #64748b;
        }

        .toc {
            background: #f8fafc;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .toc h3 {
            margin-top: 0;
            margin-bottom: 1rem;
            font-size: 1.125rem;
        }

        .toc ul {
            padding-left: 1.5rem;
            margin: 0;
        }

        .toc li {
            margin-bottom: 0.5rem;
        }

        .toc a {
            color: var(--primary-color);
            text-decoration: none;
        }

        .toc a:hover {
            text-decoration: underline;
        }

        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s;
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 1rem;
            }

            .doc-content {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Mobile Menu Toggle -->
    <button class="btn btn-primary d-lg-none fixed-top" style="top: 1rem; left: 1rem; z-index: 101;" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <a href="#" class="logo">
            <i class="fas fa-credit-card"></i>
            Laravel Payments
        </a>

        <nav class="nav-section">
            <h5>Getting Started</h5>
            <a href="#overview" class="nav-link">Overview</a>
            <a href="#installation" class="nav-link">Installation</a>
            <a href="#configuration" class="nav-link">Configuration</a>
            <a href="#basic-usage" class="nav-link">Basic Usage</a>
        </nav>

        <nav class="nav-section">
            <h5>Payment Gateways</h5>
            <a href="#stripe" class="nav-link">Stripe</a>
            <a href="#paypal" class="nav-link">PayPal</a>
            <a href="#paystack" class="nav-link">Paystack</a>
            <a href="#razorpay" class="nav-link">Razorpay</a>
            <a href="#paytm" class="nav-link">PayTM</a>
            <a href="#flutterwave" class="nav-link">Flutterwave</a>
            <a href="#sslcommerz" class="nav-link">SSLCommerz</a>
            <a href="#mollie" class="nav-link">Mollie</a>
            <a href="#senangpay" class="nav-link">SenangPay</a>
            <a href="#bkash" class="nav-link">bKash</a>
            <a href="#mercadopago" class="nav-link">Mercado Pago</a>
            <a href="#cashfree" class="nav-link">Cashfree</a>
            <a href="#payfast" class="nav-link">PayFast</a>
            <a href="#skrill" class="nav-link">Skrill</a>
            <a href="#phonepe" class="nav-link">PhonePe</a>
            <a href="#telr" class="nav-link">Telr</a>
            <a href="#iyzico" class="nav-link">iyzico</a>
            <a href="#pesapal" class="nav-link">Pesapal</a>
            <a href="#midtrans" class="nav-link">Midtrans</a>
            <a href="#myfatoorah" class="nav-link">MyFatoorah</a>
            <a href="#easypaisa" class="nav-link">EasyPaisa</a>
        </nav>

        <nav class="nav-section">
            <h5>Advanced</h5>
            <a href="#testing" class="nav-link">Testing</a>
            <a href="#error-handling" class="nav-link">Error Handling</a>
            <a href="#webhooks" class="nav-link">Webhooks</a>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Overview Section -->
        <div id="overview" class="doc-content">
            <h1>Laravel Payments Documentation</h1>
            <p class="lead">A comprehensive Laravel package for integrating multiple payment gateways into your application with a unified, easy-to-use interface.</p>

            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                <strong>Current Version:</strong> 1.0.0 |
                <strong>Laravel Version:</strong> 9.x+ |
                <strong>PHP Version:</strong> 8.1+
            </div>

            <h2>Features</h2>
            <ul>
                <li>✅ <strong>20+ Payment Gateways</strong> - Support for major global and regional payment providers</li>
                <li>✅ <strong>Unified API</strong> - Single interface for all payment gateways</li>
                <li>✅ <strong>Secure</strong> - Built with security best practices</li>
                <li>✅ <strong>Webhook Support</strong> - Built-in webhook handling for all gateways</li>
                <li>✅ <strong>Test Friendly</strong> - Comprehensive testing support</li>
                <li>✅ <strong>Type Safe</strong> - Full PHP 8.1 type declarations</li>
                <li>✅ <strong>Extensible</strong> - Easy to add new payment gateways</li>
            </ul>
        </div>

        <!-- Installation Section -->
        <div id="installation" class="doc-content">
            <h1>Installation</h1>

            <h2>Requirements</h2>
            <ul>
                <li>Laravel 9.0 or higher</li>
                <li>PHP 8.1 or higher</li>
                <li>Composer package manager</li>
            </ul>

            <h2>Step 1: Install the Package</h2>
            <pre><code class="language-bash">composer require mdiqbal/laravel-payments</code></pre>

            <h2>Step 2: Publish Configuration</h2>
            <pre><code class="language-bash">php artisan vendor:publish --provider="Mdiqbal\LaravelPayments\PaymentsServiceProvider"</code></pre>

            <h2>Step 3: Add Environment Variables</h2>
            <p>Add your payment gateway credentials to your <code>.env</code> file. Here's an example for Stripe:</p>
            <pre><code class="language-env"># Stripe Configuration
STRIPE_MODE=test  # or 'live' for production
STRIPE_SANDBOX_SECRET=sk_test_xxxxxxxxxxxxxx
STRIPE_SANDBOX_KEY=pk_test_xxxxxxxxxxxxxx
STRIPE_LIVE_SECRET=sk_live_xxxxxxxxxxxxxx
STRIPE_LIVE_KEY=pk_live_xxxxxxxxxxxxxx
STRIPE_WEBHOOK_SECRET=whsec_xxxxxxxxxxxxxx</code></pre>

            <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle"></i>
                <strong>Security Note:</strong> Never commit your API keys to version control. Always use environment variables for sensitive credentials.
            </div>
        </div>

        <!-- Configuration Section -->
        <div id="configuration" class="doc-content">
            <h1>Configuration</h1>

            <p>The package configuration is located at <code>config/payments.php</code>. This file contains configuration for all supported payment gateways.</p>

            <h2>Default Gateway</h2>
            <p>You can set a default gateway that will be used when no specific gateway is specified:</p>
            <pre><code class="language-php">'default' => env('PAYMENT_DEFAULT_GATEWAY', 'stripe'),</code></pre>

            <h2>Gateway Configuration</h2>
            <p>Each gateway has its own configuration section. Here's an example configuration structure:</p>
            <pre><code class="language-php">return [
    'default' => env('PAYMENT_DEFAULT_GATEWAY', 'stripe'),

    'gateways' => [
        'stripe' => [
            'mode' => env('STRIPE_MODE', 'sandbox'),
            'sandbox' => [
                'secret_key' => env('STRIPE_SANDBOX_SECRET'),
                'api_key' => env('STRIPE_SANDBOX_KEY'),
            ],
            'live' => [
                'secret_key' => env('STRIPE_LIVE_SECRET'),
                'api_key' => env('STRIPE_LIVE_KEY'),
            ],
            'webhook_secret' => env('STRIPE_WEBHOOK_SECRET'),
        ],

        'paypal' => [
            'mode' => env('PAYPAL_MODE', 'sandbox'),
            'sandbox' => [
                'client_id' => env('PAYPAL_SANDBOX_CLIENT_ID'),
                'client_secret' => env('PAYPAL_SANDBOX_CLIENT_SECRET'),
            ],
            'live' => [
                'client_id' => env('PAYPAL_LIVE_CLIENT_ID'),
                'client_secret' => env('PAYPAL_LIVE_CLIENT_SECRET'),
            ],
            'webhook_id' => env('PAYPAL_WEBHOOK_ID'),
        ],
    ],
];</code></pre>
        </div>

        <!-- Basic Usage Section -->
        <div id="basic-usage" class="doc-content">
            <h1>Basic Usage</h1>

            <h2>Making a Payment</h2>
            <pre><code class="language-php">use Mdiqbal\LaravelPayments\Facades\Payment;
use Mdiqbal\LaravelPayments\DTO\PaymentRequest;

// Create a payment request
$paymentRequest = new PaymentRequest(
    amount: 100.00,
    currency: 'USD',
    description: 'Payment for Order #12345'
);

// Set optional parameters
$paymentRequest->setTransactionId('order_' . uniqid());
$paymentRequest->setReturnUrl(route('payment.success'));
$paymentRequest->setCancelUrl(route('payment.cancel'));

// Process payment with default gateway
$response = Payment::pay($paymentRequest);

// Or process with a specific gateway
$response = Payment::gateway('stripe')->pay($paymentRequest);

// Handle response
if ($response->isSuccess()) {
    if ($response->isRedirect()) {
        return redirect($response->getRedirectUrl());
    }

    $transactionId = $response->getTransactionId();
    // Save transaction ID to database
} else {
    $errorMessage = $response->getMessage();
    // Handle error
}</code></pre>

            <h2>Retrieving Payment Status</h2>
            <pre><code class="language-php">use Mdiqbal\LaravelPayments\Facades\Payment;

$transactionId = 'txn_1234567890';
$response = Payment::gateway('stripe')->retrievePayment($transactionId);

if ($response->isSuccess()) {
    $status = $response->getData()['status'];
    $amount = $response->getData()['amount'];
    // Update order status
}</code></pre>

            <h2>Processing Refunds</h2>
            <pre><code class="language-php">use Mdiqbal\LaravelPayments\Facades\Payment;

$transactionId = 'txn_1234567890';
$refundAmount = 50.00;
$reason = 'Customer requested refund';

try {
    $success = Payment::gateway('stripe')->refund($transactionId, $refundAmount, $reason);

    if ($success) {
        // Refund processed successfully
    }
} catch (\Exception $e) {
    // Handle refund failure
}</code></pre>
        </div>

        <!-- Payment Gateways Grid -->
        <div class="doc-content">
            <h1>Supported Payment Gateways</h1>
            <div class="row g-4">
                <div class="col-md-6 col-lg-4">
                    <div class="gateway-card">
                        <h3 class="gateway-title">
                            <i class="fab fa-stripe"></i> Stripe
                        </h3>
                        <p class="gateway-description">Global payment gateway with support for cards, digital wallets, and local payment methods.</p>
                        <p class="gateway-regions"><strong>Regions:</strong> Global</p>
                        <a href="#stripe" class="btn btn-primary btn-sm">View Docs →</a>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="gateway-card">
                        <h3 class="gateway-title">
                            <i class="fab fa-paypal"></i> PayPal
                        </h3>
                        <p class="gateway-description">Trusted payment solution with PayPal accounts, cards, and alternative payment methods.</p>
                        <p class="gateway-regions"><strong>Regions:</strong> Global</p>
                        <a href="#paypal" class="btn btn-primary btn-sm">View Docs →</a>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="gateway-card">
                        <h3 class="gateway-title">Paystack</h3>
                        <p class="gateway-description">Leading African payment gateway supporting cards, bank transfers, and mobile money.</p>
                        <p class="gateway-regions"><strong>Regions:</strong> Africa</p>
                        <a href="#paystack" class="btn btn-primary btn-sm">View Docs →</a>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="gateway-card">
                        <h3 class="gateway-title">Razorpay</h3>
                        <p class="gateway-description">India's payment solution supporting UPI, cards, net banking, and popular wallets.</p>
                        <p class="gateway-regions"><strong>Regions:</strong> India</p>
                        <a href="#razorpay" class="btn btn-primary btn-sm">View Docs →</a>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="gateway-card">
                        <h3 class="gateway-title">Flutterwave</h3>
                        <p class="gateway-description">African payment platform with support for cards, mobile money, and bank transfers.</p>
                        <p class="gateway-regions"><strong>Regions:</strong> Africa</p>
                        <a href="#flutterwave" class="btn btn-primary btn-sm">View Docs →</a>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="gateway-card">
                        <h3 class="gateway-title">Mollie</h3>
                        <p class="gateway-description">European payment gateway supporting iDEAL, credit cards, and local methods.</p>
                        <p class="gateway-regions"><strong>Regions:</strong> Europe</p>
                        <a href="#mollie" class="btn btn-primary btn-sm">View Docs →</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Individual Gateway Documentation -->
        <div id="stripe" class="doc-content">
            <h1>Stripe Gateway</h1>
            <div class="badge bg-primary me-2">Global</div>
            <div class="badge bg-success me-2">Cards</div>
            <div class="badge bg-info me-2">Digital Wallets</div>

            <p>Stripe is a comprehensive payment platform that supports credit/debit cards, digital wallets (Apple Pay, Google Pay), and various local payment methods.</p>

            <h2>Configuration</h2>
            <p>Add these variables to your <code>.env</code> file:</p>
            <pre><code class="language-env">STRIPE_MODE=test  # or 'live' for production
STRIPE_SANDBOX_SECRET=sk_test_xxxxxxxxxxxxxx
STRIPE_SANDBOX_KEY=pk_test_xxxxxxxxxxxxxx
STRIPE_LIVE_SECRET=sk_live_xxxxxxxxxxxxxx
STRIPE_LIVE_KEY=pk_live_xxxxxxxxxxxxxx
STRIPE_WEBHOOK_SECRET=whsec_xxxxxxxxxxxxxx</code></pre>

            <h2>Quick Start</h2>
            <pre><code class="language-php">use Mdiqbal\LaravelPayments\Facades\Payment;
use Mdiqbal\LaravelPayments\DTO\PaymentRequest;

$paymentRequest = new PaymentRequest(
    amount: 100.00,
    currency: 'USD',
    description: 'Payment for Order #12345'
);

$response = Payment::gateway('stripe')->pay($paymentRequest);

if ($response->isSuccess()) {
    $clientSecret = $response->getData()['client_secret'];
    // Pass clientSecret to frontend for Stripe Elements
}</code></pre>

            <h2>Frontend Integration</h2>
            <p>Include Stripe.js and create a payment form:</p>
            <pre><code class="language-html">&lt;script src="https://js.stripe.com/v3/"&gt;&lt;/script&gt;
&lt;script&gt;
    const stripe = Stripe('{{ config("payments.gateways.stripe." . config("payments.gateways.stripe.mode") . ".api_key") }}');
    const clientSecret = '{{ $clientSecret }}';

    const elements = stripe.elements({
        clientSecret: clientSecret,
        appearance: { theme: 'stripe' }
    });

    const paymentElement = elements.create('payment');
    paymentElement.mount('#payment-element');

    // Handle form submission
    const form = document.getElementById('payment-form');
    form.addEventListener('submit', async (event) => {
        event.preventDefault();
        const {error} = await stripe.confirmPayment({
            elements,
            confirmParams: {
                return_url: '{{ route("payment.success") }}',
            },
        });
    });
&lt;/script&gt;</code></pre>

            <h2>Webhook Setup</h2>
            <ol>
                <li>Go to Stripe Dashboard → Developers → Webhooks</li>
                <li>Add endpoint: <code>https://your-domain.com/payment/webhook/stripe</code></li>
                <li>Select events: <code>payment_intent.succeeded</code>, <code>payment_intent.payment_failed</code></li>
                <li>Copy the webhook secret to your <code>.env</code> file</li>
            </ol>

            <h2>Testing</h2>
            <p>Use Stripe's test cards for testing:</p>
            <ul>
                <li><strong>Success:</strong> 4242424242424242</li>
                <li><strong>Declined:</strong> 4000000000000002</li>
                <li><strong>Insufficient Funds:</strong> 4000000000009995</li>
                <li><strong>Expired Card:</strong> 4000000000000069</li>
            </ul>
        </div>

        <!-- Add similar sections for other gateways (paypal, paystack, etc.) -->
        <!-- For brevity, I'm showing just a few examples -->

        <div id="paypal" class="doc-content">
            <h1>PayPal Gateway</h1>
            <div class="badge bg-primary me-2">Global</div>
            <div class="badge bg-success me-2">PayPal Account</div>
            <div class="badge bg-info me-2">Cards</div>
            <div class="badge bg-warning me-2">Venmo</div>

            <p>PayPal provides a trusted payment solution with support for PayPal accounts, credit/debit cards, and alternative payment methods like Venmo.</p>

            <h2>Configuration</h2>
            <pre><code class="language-env">PAYPAL_MODE=sandbox  # or 'live' for production
PAYPAL_SANDBOX_CLIENT_ID=your_sandbox_client_id
PAYPAL_SANDBOX_CLIENT_SECRET=your_sandbox_client_secret
PAYPAL_LIVE_CLIENT_ID=your_live_client_id
PAYPAL_LIVE_CLIENT_SECRET=your_live_client_secret
PAYPAL_WEBHOOK_ID=your_webhook_id</code></pre>

            <h2>Quick Start</h2>
            <pre><code class="language-php">$paymentRequest = new PaymentRequest(
    amount: 100.00,
    currency: 'USD',
    description: 'Payment for Order #12345'
);

$response = Payment::gateway('paypal')->pay($paymentRequest);

if ($response->isRedirect()) {
    return redirect($response->getRedirectUrl());
}</code></pre>
        </div>

        <div id="testing" class="doc-content">
            <h1>Testing</h1>

            <h2>Running Tests</h2>
            <pre><code class="language-bash"># Run all tests
composer test

# Run specific test
composer test -- --filter StripePaymentTest

# Generate coverage report
composer test -- --coverage</code></pre>

            <h2>Test Configuration</h2>
            <p>Create a <code>.env.testing</code> file for test environment:</p>
            <pre><code class="language-env">PAYMENT_DEFAULT_GATEWAY=stripe
STRIPE_MODE=test
STRIPE_SANDBOX_SECRET=sk_test_xxxxxxxxxxxxxx
STRIPE_SANDBOX_KEY=pk_test_xxxxxxxxxxxxxx</code></pre>

            <h2>Test Example</h2>
            <pre><code class="language-php">public function test_stripe_payment()
{
    $paymentRequest = new PaymentRequest(
        amount: 10.00,
        currency: 'USD',
        description: 'Test Payment'
    );

    $paymentRequest->setTransactionId('test_order_123');

    $response = Payment::gateway('stripe')->pay($paymentRequest);

    $this->assertTrue($response->isSuccess());
    $this->assertNotNull($response->getData()['client_secret']);
}</code></pre>
        </div>

        <div id="error-handling" class="doc-content">
            <h1>Error Handling</h1>

            <p>The package provides comprehensive error handling for various scenarios:</p>

            <h2>Exception Types</h2>
            <ul>
                <li><code>PaymentException</code> - General payment processing errors</li>
                <li><code>GatewayNotFoundException</code> - Gateway not configured</li>
                <li><code>ValidationException</code> - Invalid payment data</li>
                <li><code>RefundException</code> - Refund processing errors</li>
            </ul>

            <h2>Handling Errors</h2>
            <pre><code class="language-php">use Mdiqbal\LaravelPayments\Exceptions\PaymentException;

try {
    $response = Payment::gateway('stripe')->pay($paymentRequest);
} catch (PaymentException $e) {
    Log::error('Payment failed: ' . $e->getMessage());
    return response()->json([
        'error' => 'Payment processing failed',
        'message' => $e->getMessage()
    ], 400);
} catch (\Exception $e) {
    Log::error('Unexpected error: ' . $e->getMessage());
    return response()->json([
        'error' => 'An unexpected error occurred'
    ], 500);
}</code></pre>

            <h2>Error Responses</h2>
            <p>When a payment fails, the response object contains:</p>
            <pre><code class="language-php">if (!$response->isSuccess()) {
    $errorCode = $response->getErrorCode();
    $errorMessage = $response->getMessage();
    $gatewayResponse = $response->getData(); // Raw gateway response

    // Handle specific error codes
    switch ($errorCode) {
        case 'insufficient_funds':
            return 'Insufficient funds in your account';
        case 'expired_card':
            return 'Your card has expired';
        case 'card_declined':
            return 'Your card was declined';
        default:
            return 'Payment failed. Please try again.';
    }
}</code></pre>
        </div>

        <div id="webhooks" class="doc-content">
            <h1>Webhook Handling</h1>

            <p>Webhooks allow payment gateways to notify your application about payment events in real-time.</p>

            <h2>Setting Up Webhooks</h2>
            <ol>
                <li>Create a webhook endpoint in your gateway's dashboard</li>
                <li>Point it to your application (e.g., <code>https://your-domain.com/payment/webhook/{gateway}</code>)</li>
                <li>Configure which events to send</li>
                <li>Copy the webhook secret to your <code>.env</code> file</li>
            </ol>

            <h2>Creating Webhook Routes</h2>
            <pre><code class="language-php">// routes/api.php
Route::post('/payment/webhook/{gateway}', [WebhookController::class, 'handle'])
    ->middleware(['api', 'throttle:60,1']);</code></pre>

            <h2>Webhook Controller</h2>
            <pre><code class="language-php">namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Mdiqbal\LaravelPayments\Facades\Payment;

class WebhookController extends Controller
{
    public function handle(Request $request, string $gateway)
    {
        $payload = $request->json()->all();

        try {
            $response = Payment::gateway($gateway)->verify($payload);

            if ($response->isSuccess()) {
                $eventData = $response->getData();
                $eventType = $eventData['event_type'] ?? $eventData['type'] ?? null;
                $transactionId = $response->getTransactionId();

                // Find related order
                $order = Order::where('transaction_id', $transactionId)->first();

                if ($order) {
                    switch ($eventType) {
                        case 'payment_intent.succeeded':
                            $order->status = 'paid';
                            $order->paid_at = now();
                            $order->save();
                            break;

                        case 'payment_intent.payment_failed':
                            $order->status = 'failed';
                            $order->save();
                            break;
                    }
                }
            }

            return response()->json(['status' => 'success']);
        } catch (\Exception $e) {
            \Log::error("Webhook error for {$gateway}: " . $e->getMessage());
            return response()->json(['error' => $e->getMessage()], 400);
        }
    }
}</code></pre>

            <h2>Common Webhook Events</h2>
            <ul>
                <li><strong>Payment Successful:</strong> <code>payment_intent.succeeded</code>, <code>payment.completed</code></li>
                <li><strong>Payment Failed:</strong> <code>payment_intent.payment_failed</code>, <code>payment.failed</code></li>
                <li><strong>Refund:</strong> <code>charge.dispute.created</code>, <code>refund.succeeded</code></li>
                <li><strong>Subscription:</strong> <code>invoice.payment_succeeded</code>, <code>customer.subscription.deleted</code></li>
            </ul>

            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                <strong>Note:</strong> Always verify webhook signatures to ensure requests are coming from the payment gateway.
            </div>
        </div>

        <!-- Footer -->
        <footer class="doc-content text-center">
            <p>&copy; 2024 Laravel Payments. All rights reserved.</p>
            <p>
                <a href="https://github.com/your-username/laravel-payments" class="me-3">
                    <i class="fab fa-github"></i> GitHub
                </a>
                <a href="https://discord.gg/laravel-payments" class="me-3">
                    <i class="fab fa-discord"></i> Discord
                </a>
                <a href="mailto:support@laravel-payments.com">
                    <i class="fas fa-envelope"></i> Support
                </a>
            </p>
        </footer>
    </main>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-php.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>

    <script>
        // Sidebar toggle for mobile
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('show');
        }

        // Smooth scrolling for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });

                    // Update active nav link
                    document.querySelectorAll('.nav-link').forEach(link => {
                        link.classList.remove('active');
                    });
                    this.classList.add('active');

                    // Close sidebar on mobile
                    if (window.innerWidth < 992) {
                        document.getElementById('sidebar').classList.remove('show');
                    }
                }
            });
        });

        // Highlight active section on scroll
        window.addEventListener('scroll', () => {
            const sections = document.querySelectorAll('.doc-content[id]');
            const scrollY = window.pageYOffset;

            sections.forEach(section => {
                const sectionHeight = section.offsetHeight;
                const sectionTop = section.offsetTop - 100;
                const sectionId = section.getAttribute('id');
                const navLink = document.querySelector(`.nav-link[href="#${sectionId}"]`);

                if (scrollY > sectionTop && scrollY <= sectionTop + sectionHeight) {
                    navLink?.classList.add('active');
                } else {
                    navLink?.classList.remove('active');
                }
            });
        });

        // Initialize code highlighting
        Prism.highlightAll();
    </script>
</body>
</html>